{{define "base"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="common.ink - Persistent memory and live deployment for your AI tools">
    <title>{{if .Title}}{{.Title}} - {{end}}common.ink</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    (function() {
      var themes = {
        'default': {
          darkMode: 'class',
          theme: { extend: {
            colors: {
              primary: {50:'#eff6ff',100:'#dbeafe',200:'#bfdbfe',300:'#93c5fd',400:'#60a5fa',500:'#3b82f6',600:'#2563eb',700:'#1d4ed8',800:'#1e40af',900:'#1e3a8a'},
              success: {50:'#f0fdf4',100:'#dcfce7',200:'#bbf7d0',300:'#86efac',400:'#4ade80',500:'#22c55e',600:'#16a34a',700:'#15803d',800:'#166534',900:'#14532d'},
              error: {50:'#fef2f2',100:'#fee2e2',200:'#fecaca',300:'#fca5a5',400:'#f87171',500:'#ef4444',600:'#dc2626',700:'#b91c1c',800:'#991b1b',900:'#7f1d1d'},
              warning: {50:'#fffbeb',100:'#fef3c7',200:'#fde68a',300:'#fcd34d',400:'#fbbf24',500:'#f59e0b',600:'#d97706',700:'#b45309',800:'#92400e',900:'#78350f'}
            },
            borderRadius: {'card':'0.75rem','input':'0.5rem','badge':'9999px'},
            boxShadow: {'card':'0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1)','card-hover':'0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1)','subtle':'0 1px 2px 0 rgba(0,0,0,0.05)'},
            fontFamily: {'display':['ui-sans-serif','system-ui','sans-serif'],'body':['ui-sans-serif','system-ui','sans-serif']}
          }}
        },
        'academic': {
          darkMode: 'class',
          theme: { extend: {
            colors: {
              primary: {50:'#fdf5f0',100:'#fbe8dc',200:'#f6cdb5',300:'#f0ab85',400:'#e88453',500:'#c4633a',600:'#ae5630',700:'#924628',800:'#773a22',900:'#62301d'},
              success: {50:'#f0f7f0',100:'#dceddc',200:'#b8dbb8',300:'#88c488',400:'#5aab5a',500:'#3d8b3d',600:'#2f6e2f',700:'#275a27',800:'#224922',900:'#1d3d1d'},
              error: {50:'#fef2f2',100:'#fee2e2',200:'#fecaca',300:'#fca5a5',400:'#f87171',500:'#ef4444',600:'#dc2626',700:'#b91c1c',800:'#991b1b',900:'#7f1d1d'},
              warning: {50:'#fffbeb',100:'#fef3c7',200:'#fde68a',300:'#fcd34d',400:'#fbbf24',500:'#f59e0b',600:'#d97706',700:'#b45309',800:'#92400e',900:'#78350f'},
              gray: {50:'#F5F5F0',100:'#EBEBDF',200:'#d4d4c8',300:'#b0b0a4',400:'#8d8d82',500:'#6b6a60',600:'#55544c',700:'#403f3a',800:'#2b2a27',900:'#1a1a18'}
            },
            borderRadius: {'card':'0.25rem','input':'0','badge':'9999px','lg':'0.125rem','xl':'0.25rem','2xl':'0.375rem'},
            boxShadow: {'card':'0 0.25rem 1.25rem rgba(0,0,0,0.035)','card-hover':'0 0.5rem 2rem rgba(0,0,0,0.06)','subtle':'0 1px 2px 0 rgba(0,0,0,0.03)','sm':'0 1px 2px rgba(0,0,0,0.03)','lg':'0 0.25rem 1.25rem rgba(0,0,0,0.035)'},
            fontFamily: {'display':['Georgia',"'Times New Roman'",'serif'],'body':['Georgia',"'Times New Roman'",'serif']}
          }}
        },
        'neonfizz': {
          darkMode: 'class',
          theme: { extend: {
            colors: {
              primary: {50:'#f5f3ff',100:'#ede9fe',200:'#ddd6fe',300:'#c4b5fd',400:'#a78bfa',500:'#8b5cf6',600:'#7c3aed',700:'#6d28d9',800:'#5b21b6',900:'#4c1d95'},
              success: {50:'#ecfdf5',100:'#d1fae5',200:'#a7f3d0',300:'#6ee7b7',400:'#43B581',500:'#23A55A',600:'#16a34a',700:'#15803d',800:'#166534',900:'#14532d'},
              error: {50:'#fef2f2',100:'#fee2e2',200:'#fecaca',300:'#fca5a5',400:'#f87171',500:'#F23F43',600:'#ED4245',700:'#b91c1c',800:'#991b1b',900:'#7f1d1d'},
              warning: {50:'#fffbeb',100:'#fef3c7',200:'#fde68a',300:'#fcd34d',400:'#FAA61A',500:'#F0B232',600:'#d97706',700:'#b45309',800:'#92400e',900:'#78350f'},
              gray: {50:'#f2f3f5',100:'#ebedef',200:'#d4d7dc',300:'#b9bbbe',400:'#949BA4',500:'#80848E',600:'#4E5058',700:'#383A40',800:'#313338',900:'#2B2D31',950:'#1E1F22'}
            },
            borderRadius: {'card':'1.25rem','input':'0.75rem','badge':'9999px','lg':'1rem','xl':'1.25rem','2xl':'1.5rem'},
            boxShadow: {'card':'0 1px 0 rgba(4,4,5,0.2), 0 1.5px 0 rgba(6,6,7,0.05), 0 2px 0 rgba(4,4,5,0.05)','card-hover':'0 4px 4px rgba(0,0,0,0.16)','subtle':'0 1px 0 rgba(4,4,5,0.1)','sm':'0 1px 0 rgba(4,4,5,0.1)','lg':'0 1px 0 rgba(4,4,5,0.2), 0 1.5px 0 rgba(6,6,7,0.05), 0 2px 0 rgba(4,4,5,0.05)'},
            fontFamily: {'display':["'SF Mono'",'ui-monospace','Consolas','monospace'],'body':['system-ui','-apple-system','sans-serif']}
          }}
        }
      };
      var t = localStorage.getItem('ci_theme') || 'default';
      document.documentElement.setAttribute('data-theme', t);
      tailwind.config = themes[t] || themes['default'];
    })();
    </script>
    <style type="text/tailwindcss">
        @layer base {
            h1, h2, h3, h4, h5, h6 { @apply font-display; }

            /* Default theme */
            [data-theme="default"] {
                --ci-texture: radial-gradient(circle, rgba(156,163,175,0.3) 0.5px, transparent 0.5px);
                --ci-texture-size: 20px 20px;
                --ci-glow: none;
                --ci-glow-hover: none;
                --ci-glow-focus: none;
            }
            html.dark[data-theme="default"] {
                --ci-texture: radial-gradient(circle, rgba(255,255,255,0.05) 0.5px, transparent 0.5px);
            }
            [data-theme="default"] :is(h1, h2, h3) { @apply tracking-tight; }

            /* Academic theme */
            [data-theme="academic"] {
                --ci-texture: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.015) 10px, rgba(0,0,0,0.015) 11px);
                --ci-texture-size: 100% 100%;
                --ci-glow: none;
                --ci-glow-hover: none;
                --ci-glow-focus: none;
            }
            html.dark[data-theme="academic"] {
                --ci-texture: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.01) 10px, rgba(255,255,255,0.01) 11px);
            }
            [data-theme="academic"] body { line-height: 1.8; }
            [data-theme="academic"] :is(h1, h2, h3, h4, h5, h6) { @apply tracking-tight; }

            /* Neonfizz theme */
            [data-theme="neonfizz"] {
                --ci-texture: repeating-linear-gradient(0deg, transparent 0px, transparent 2px, rgba(255,255,255,0.015) 2px, rgba(255,255,255,0.015) 4px);
                --ci-texture-size: 100% 4px;
                --ci-glow: 0 0 15px rgba(139,92,246,0.3);
                --ci-glow-hover: 0 0 25px rgba(139,92,246,0.5);
                --ci-glow-focus: 0 0 0 2px rgba(139,92,246,0.5), 0 0 15px rgba(139,92,246,0.3);
            }
            [data-theme="neonfizz"] :is(h1, h2, h3) { @apply uppercase tracking-tighter; }
        }

        @layer components {
            /* Page texture overlay */
            .themed-page::before {
                content: '';
                position: fixed;
                inset: 0;
                background: var(--ci-texture);
                background-size: var(--ci-texture-size);
                pointer-events: none;
                z-index: -1;
            }

            /* Themed card */
            .themed-card {
                @apply bg-white dark:bg-gray-800 rounded-card shadow-card overflow-hidden;
                transition: all 0.2s ease;
            }
            [data-theme="default"] .themed-card { @apply border-t-2 border-t-primary-500; }
            [data-theme="default"] .themed-card:hover {
                @apply shadow-card-hover;
            }
            [data-theme="academic"] .themed-card {
                @apply border-l-4 border-l-primary-500;
                box-shadow: none;
            }
            [data-theme="academic"] .themed-card:hover { @apply border-l-primary-700; }
            [data-theme="neonfizz"] .themed-card:hover { box-shadow: var(--ci-glow); }

            /* Themed primary button */
            .themed-btn-primary {
                @apply inline-flex items-center justify-center font-semibold rounded-input text-white bg-primary-600 hover:bg-primary-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 dark:focus:ring-offset-gray-900;
                transition: all 0.2s ease;
            }
            [data-theme="default"] .themed-btn-primary:hover { transform: scale(1.02); }
            [data-theme="neonfizz"] .themed-btn-primary { box-shadow: var(--ci-glow); }
            [data-theme="neonfizz"] .themed-btn-primary:hover { box-shadow: var(--ci-glow-hover); }

            /* Themed secondary button */
            .themed-btn-secondary {
                @apply inline-flex items-center justify-center font-semibold rounded-input border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 dark:focus:ring-offset-gray-900;
                transition: all 0.2s ease;
            }

            /* Themed danger button */
            .themed-btn-danger {
                @apply inline-flex items-center justify-center font-semibold rounded-input text-white bg-error-600 hover:bg-error-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-error-600 focus:ring-offset-2 dark:focus:ring-offset-gray-900;
                transition: all 0.2s ease;
            }

            /* Themed prose */
            .themed-prose pre { overflow-x: auto; }
            [data-theme="academic"] .themed-prose { @apply max-w-3xl mx-auto; }
            [data-theme="academic"] .themed-prose > p:first-of-type { text-indent: 1.5em; }

            /* Themed hero heading */
            [data-theme="neonfizz"] .themed-hero-heading {
                @apply bg-gradient-to-r from-primary-400 to-primary-300 bg-clip-text;
                -webkit-text-fill-color: transparent;
            }

            /* Themed focus (neonfizz glow ring) */
            [data-theme="neonfizz"] .themed-focus:focus {
                outline: none;
                box-shadow: var(--ci-glow-focus);
            }
        }
    </style>
    <script>
    (function(){
      var t = localStorage.getItem('ci_theme') || 'default';
      var explicitMode = localStorage.getItem('ci_darkmode');
      var m = explicitMode || 'system';
      if (t === 'neonfizz' && !explicitMode) m = 'dark';
      var dark = m === 'dark' || (m === 'system' && matchMedia('(prefers-color-scheme:dark)').matches);
      if (dark) document.documentElement.classList.add('dark');
      if (m === 'system') matchMedia('(prefers-color-scheme:dark)')
        .addEventListener('change', function(e){ document.documentElement.classList.toggle('dark', e.matches); });
    })();
    </script>
    {{block "head" .}}{{end}}
</head>
<body class="themed-page min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-body" style="opacity:0">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-subtle border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- Left side: Logo -->
                <div class="flex items-center">
                    <a href="/" class="flex items-center">
                        <svg class="h-8 w-8 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <span class="ml-2 text-xl font-bold text-gray-900 dark:text-white">common.ink</span>
                    </a>
                </div>

                <!-- Desktop navigation -->
                <div class="hidden sm:flex sm:items-center sm:space-x-4">
                    <!-- Always-visible links -->
                    <a href="/docs/install" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white px-3 py-2 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        Install
                    </a>
                    {{if or (not .User) (ne .User.SubscriptionStatus "active")}}
                    <a href="/pricing" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white px-3 py-2 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        Get Pro
                    </a>
                    {{end}}
                    {{if .User}}
                    <!-- Auth navigation links -->
                    <a href="/notes" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white px-3 py-2 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        My Notes
                    </a>
                    <!-- User dropdown -->
                    <div class="relative" id="user-menu-container">
                        <button type="button"
                                id="user-menu-button"
                                class="flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 dark:focus:ring-offset-gray-800 rounded-lg px-3 py-2"
                                aria-expanded="false"
                                aria-haspopup="true">
                            <span class="text-sm font-medium">{{.User.Email}}</span>
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <!-- Dropdown menu -->
                        <div id="user-dropdown"
                             class="hidden absolute right-0 mt-2 w-56 origin-top-right rounded-card bg-white dark:bg-gray-800 shadow-card ring-1 ring-black ring-opacity-5 focus:outline-none z-50"
                             role="menu"
                             aria-orientation="vertical"
                             aria-labelledby="user-menu-button">
                            <!-- User email header -->
                            <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Signed in as</p>
                                <p class="mt-1 text-sm font-medium text-gray-900 dark:text-white truncate">{{.User.Email}}</p>
                            </div>
                            <!-- Menu items -->
                            <div class="py-1">
                                <a href="/api-keys" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">
                                    <svg class="mr-3 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                                    </svg>
                                    API Keys
                                </a>
                                <a href="/settings/account" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">
                                    <svg class="mr-3 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    Account
                                </a>
                                {{if eq .User.SubscriptionStatus "active"}}
                                <a href="/settings/billing" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">
                                    <svg class="mr-3 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                    </svg>
                                    Billing
                                </a>
                                {{end}}
                            </div>
                            <!-- Separator and logout -->
                            <div class="border-t border-gray-200 dark:border-gray-700">
                                <form action="/auth/logout" method="POST" class="w-full">
                                    <button type="submit" class="flex w-full items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">
                                        <svg class="mr-3 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                        </svg>
                                        Sign out
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {{else}}
                    <!-- Pricing link for logged-out users -->
                    <a href="/pricing" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white px-3 py-2 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        Get Pro
                    </a>
                    <!-- Login button -->
                    <a href="/login" class="themed-btn-primary px-4 py-2 text-sm">
                        Sign in
                    </a>
                    {{end}}
                </div>

                <!-- Mobile menu button -->
                <div class="flex items-center sm:hidden">
                    <button type="button"
                            id="mobile-menu-button"
                            class="inline-flex items-center justify-center p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-600"
                            aria-controls="mobile-menu"
                            aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <!-- Hamburger icon -->
                        <svg id="hamburger-icon" class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <!-- Close icon -->
                        <svg id="close-icon" class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div class="hidden sm:hidden" id="mobile-menu">
            <div class="pt-2 pb-3 space-y-1 border-t border-gray-200 dark:border-gray-700">
                {{if .User}}
                <!-- User email header -->
                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                    <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Signed in as</p>
                    <p class="mt-1 text-sm font-medium text-gray-900 dark:text-white">{{.User.Email}}</p>
                </div>
                <!-- Navigation links -->
                <a href="/notes" class="flex items-center px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="mr-3 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    My Notes
                </a>
                <a href="/api-keys" class="flex items-center px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="mr-3 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                    </svg>
                    API Keys
                </a>
                {{if ne .User.SubscriptionStatus "active"}}
                <a href="/pricing" class="flex items-center px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="mr-3 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                    </svg>
                    Get Pro
                </a>
                {{end}}
                <a href="/settings/account" class="flex items-center px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="mr-3 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    Account
                </a>
                <!-- Separator and logout -->
                <div class="border-t border-gray-200 dark:border-gray-700 mt-2 pt-2">
                    <form action="/auth/logout" method="POST" class="w-full">
                        <button type="submit" class="flex w-full items-center px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                            <svg class="mr-3 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                            Sign out
                        </button>
                    </form>
                </div>
                {{else}}
                <a href="/login" class="block px-4 py-2 text-base font-medium text-primary-600 dark:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-700">
                    Sign in
                </a>
                <a href="/pricing" class="block px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                    Get Pro
                </a>
                {{end}}
                {{if not .User}}
                <!-- Always-visible mobile links -->
                <div class="border-t border-gray-200 dark:border-gray-700 mt-2 pt-2">
                    <a href="/docs/install" class="flex items-center px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                        Install
                    </a>
                    <a href="/pricing" class="flex items-center px-4 py-2 text-base font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                        Get Pro
                    </a>
                </div>
                {{end}}
            </div>
        </div>
    </nav>

    <!-- Main content -->
    <main class="flex-1">
        {{template "content" .}}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
            <div class="md:flex md:items-center md:justify-between">
                <div class="mt-4 sm:mt-6 md:mt-0 md:order-1">
                    <span class="font-display text-lg font-bold text-gray-800 dark:text-gray-200">common.ink</span>
                </div>
                <div class="flex justify-center flex-wrap items-center gap-x-6 gap-y-2 md:order-2">
                    <a href="/about" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 text-sm">About</a>
                    <a href="/faq" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 text-sm">FAQ</a>
                    <a href="/privacy" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 text-sm">Privacy</a>
                    <a href="/terms" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 text-sm">Terms</a>
                    <div id="appearance-controls" class="flex items-center gap-2 pl-4 border-l border-gray-300 dark:border-gray-600">
                        <button id="darkmode-toggle" type="button" class="p-1.5 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" aria-label="Toggle dark mode">
                            <svg id="dm-icon-system" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                            <svg id="dm-icon-light" class="w-4 h-4 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                            <svg id="dm-icon-dark" class="w-4 h-4 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                        </button>
                        <div id="theme-swatches" class="flex items-center gap-1.5">
                            <button data-theme="default" class="w-5 h-5 rounded-full bg-[#2563eb] transition-shadow" title="Default" aria-label="Default theme"></button>
                            <button data-theme="academic" class="w-5 h-5 rounded-full bg-[#ae5630] transition-shadow" title="Academic" aria-label="Academic theme"></button>
                            <button data-theme="neonfizz" class="w-5 h-5 rounded-full bg-[#7c3aed] transition-shadow" title="Neon Fizz" aria-label="Neon Fizz theme"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Minimal JavaScript for mobile menu and user dropdown toggle -->
    <script>
        // Mobile menu toggle
        (function() {
            var mobileMenuButton = document.getElementById('mobile-menu-button');
            var mobileMenu = document.getElementById('mobile-menu');
            var hamburgerIcon = document.getElementById('hamburger-icon');
            var closeIcon = document.getElementById('close-icon');

            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    var expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
                    mobileMenuButton.setAttribute('aria-expanded', !expanded);
                    mobileMenu.classList.toggle('hidden');
                    hamburgerIcon.classList.toggle('hidden');
                    hamburgerIcon.classList.toggle('block');
                    closeIcon.classList.toggle('hidden');
                    closeIcon.classList.toggle('block');
                });
            }

            // User dropdown toggle
            var userMenuButton = document.getElementById('user-menu-button');
            var userDropdown = document.getElementById('user-dropdown');

            if (userMenuButton && userDropdown) {
                userMenuButton.addEventListener('click', function() {
                    var expanded = userMenuButton.getAttribute('aria-expanded') === 'true';
                    userMenuButton.setAttribute('aria-expanded', !expanded);
                    userDropdown.classList.toggle('hidden');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    var container = document.getElementById('user-menu-container');
                    if (container && !container.contains(event.target)) {
                        userDropdown.classList.add('hidden');
                        userMenuButton.setAttribute('aria-expanded', 'false');
                    }
                });
            }
        })();
    </script>
    <!-- Appearance controls JS -->
    <script>
    (function(){
        var modes = ['system', 'light', 'dark'];
        var btn = document.getElementById('darkmode-toggle');
        var icons = {
            system: document.getElementById('dm-icon-system'),
            light: document.getElementById('dm-icon-light'),
            dark: document.getElementById('dm-icon-dark')
        };
        function getCurrentMode() { return localStorage.getItem('ci_darkmode') || 'system'; }
        function setDarkIcon(mode) {
            Object.keys(icons).forEach(function(k) { if (icons[k]) icons[k].classList.toggle('hidden', k !== mode); });
        }
        function applyDarkMode(mode) {
            var html = document.documentElement;
            if (mode === 'dark') html.classList.add('dark');
            else if (mode === 'light') html.classList.remove('dark');
            else html.classList.toggle('dark', matchMedia('(prefers-color-scheme:dark)').matches);
        }
        setDarkIcon(getCurrentMode());
        if (btn) {
            btn.addEventListener('click', function() {
                var current = getCurrentMode();
                var next = modes[(modes.indexOf(current) + 1) % modes.length];
                localStorage.setItem('ci_darkmode', next);
                setDarkIcon(next);
                applyDarkMode(next);
            });
        }
        var swatches = document.getElementById('theme-swatches');
        var currentTheme = localStorage.getItem('ci_theme') || 'default';
        if (swatches) {
            swatches.querySelectorAll('button[data-theme]').forEach(function(b) {
                if (b.getAttribute('data-theme') === currentTheme) b.classList.add('ring-2', 'ring-offset-2', 'ring-gray-900', 'dark:ring-white');
                b.addEventListener('click', function() {
                    var theme = b.getAttribute('data-theme');
                    if (theme !== currentTheme) { localStorage.setItem('ci_theme', theme); location.reload(); }
                });
            });
        }
    })();
    </script>
    <!-- Fade in after Tailwind CDN processes -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.body.style.transition = 'opacity 0.15s ease';
        document.body.style.opacity = '1';
    });
    </script>
</body>
</html>
{{end}}

{{define "content"}}
<!-- Default empty content block - override in child templates -->
{{end}}

{{/* ========== Reusable Alert Partials ========== */}}

{{define "alert-success"}}
{{if .}}
<div class="rounded-card bg-success-50 dark:bg-success-900/20 p-4 border border-success-200 dark:border-success-800" role="status">
    <div class="flex">
        <svg class="h-5 w-5 text-success-600 dark:text-success-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <p class="ml-3 text-sm font-medium text-success-800 dark:text-success-200">{{.}}</p>
    </div>
</div>
{{end}}
{{end}}

{{define "alert-error"}}
{{if .}}
<div class="rounded-card bg-error-50 dark:bg-error-900/20 p-4 border border-error-200 dark:border-error-800" role="alert">
    <div class="flex">
        <svg class="h-5 w-5 text-error-600 dark:text-error-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <p class="ml-3 text-sm font-medium text-error-800 dark:text-error-200">{{.}}</p>
    </div>
</div>
{{end}}
{{end}}

{{define "alert-warning"}}
{{if .}}
<div class="rounded-card bg-warning-50 dark:bg-warning-900/20 p-4 border border-warning-200 dark:border-warning-800" role="alert">
    <div class="flex">
        <svg class="h-5 w-5 text-warning-600 dark:text-warning-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
        </svg>
        <p class="ml-3 text-sm font-medium text-warning-800 dark:text-warning-200">{{.}}</p>
    </div>
</div>
{{end}}
{{end}}

{{define "alert-info"}}
{{if .}}
<div class="rounded-card bg-primary-50 dark:bg-primary-900/20 p-4 border border-primary-200 dark:border-primary-800" role="status">
    <div class="flex">
        <svg class="h-5 w-5 text-primary-600 dark:text-primary-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <p class="ml-3 text-sm font-medium text-primary-800 dark:text-primary-200">{{.}}</p>
    </div>
</div>
{{end}}
{{end}}

{{/* ========== Reusable Icon Circle Partials ========== */}}

{{define "icon-circle-success"}}
<div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-success-100 dark:bg-success-900/30">
    <svg class="h-8 w-8 text-success-600 dark:text-success-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
</div>
{{end}}

{{define "icon-circle-error"}}
<div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-error-100 dark:bg-error-900/30">
    <svg class="h-8 w-8 text-error-600 dark:text-error-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
    </svg>
</div>
{{end}}

{{define "icon-circle-primary"}}
<div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-primary-100 dark:bg-primary-900/30">
    <svg class="h-8 w-8 text-primary-600 dark:text-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
    </svg>
</div>
{{end}}

{{/* ========== Reusable Logo Partials ========== */}}

{{define "google-logo-svg"}}
<svg class="h-5 w-5" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
</svg>
{{end}}

{{/* ========== Reusable Pricing Partials ========== */}}

{{define "pricing-check"}}
<svg class="h-5 w-5 text-success-500 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
{{end}}

{{define "pricing-free-features"}}
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">Free</h3>
<p class="mt-4"><span class="text-4xl font-bold text-gray-900 dark:text-white">$0</span><span class="text-gray-500 dark:text-gray-400">/mo</span></p>
<ul class="mt-6 space-y-3 text-gray-600 dark:text-gray-300">
    <li class="flex items-center">{{template "pricing-check"}}100 MB note storage</li>
    <li class="flex items-center">{{template "pricing-check"}}1 live app</li>
    <li class="flex items-center">{{template "pricing-check"}}10 requests/second</li>
    <li class="flex items-center">{{template "pricing-check"}}Web + MCP access</li>
</ul>
{{end}}

{{define "pricing-pro-features"}}
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">Pro</h3>
<p class="mt-4"><span class="text-4xl font-bold text-gray-900 dark:text-white">$5</span><span class="text-gray-500 dark:text-gray-400">/mo &nbsp;&middot;&nbsp; $50/yr</span></p>
<ul class="mt-6 space-y-3 text-gray-600 dark:text-gray-300">
    <li class="flex items-center">{{template "pricing-check"}}Unlimited note storage</li>
    <li class="flex items-center">{{template "pricing-check"}}5 live apps</li>
    <li class="flex items-center">{{template "pricing-check"}}1,000 requests/second</li>
    <li class="flex items-center">{{template "pricing-check"}}Priority support</li>
</ul>
{{end}}
