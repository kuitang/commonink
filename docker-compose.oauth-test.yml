version: '3.8'

services:
  # OpenID Foundation conformance suite
  # Source: https://gitlab.com/openid/conformance-suite
  conformance-suite:
    image: ghcr.io/openid-certification/conformance-suite:latest
    container_name: oauth-conformance-suite
    ports:
      - "8443:8443"
    environment:
      - BASE_URL=https://localhost:8443
      - MONGODB_HOST=mongo
      - MONGODB_PORT=27017
      - MONGODB_DATABASE=conformance
    depends_on:
      - mongo
    networks:
      - oauth-test-network
    volumes:
      - conformance-data:/conformance-suite

  # MongoDB for conformance suite data
  mongo:
    image: mongo:7
    container_name: oauth-mongo
    ports:
      - "27017:27017"
    networks:
      - oauth-test-network
    volumes:
      - mongo-data:/data/db

  # Our OAuth server under test (when implemented)
  # Uncomment when server is ready
  # oauth-server:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: remote-notes-server
  #   ports:
  #     - "8080:8080"
  #   networks:
  #     - oauth-test-network
  #   environment:
  #     - OAUTH_BASE_URL=http://localhost:8080/oauth

networks:
  oauth-test-network:
    driver: bridge

volumes:
  conformance-data:
  mongo-data:
